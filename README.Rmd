---
title: 'Final Report'
author: "Roba Abbajabal, Conor O'Shea, Aadhi Subbiah, Daniel Nass"
date: "11/11/2023"
output: html_document
---

### Introduction
- For our research, we wished to analyze transportation safety in the US by state from 2010-2021.
- This involved observing fatalities by state and year, and then connecting that information with outside sources.
- This research particularly interests us, because we wish to find reasons of what may cause safer roads.


### Research Title: An Analysis on Transportation Safety in the US
### Team Members: Roba Abbajabal, Conor O'Shea, Aadhi Subbiah, Daniel Nass

#### Description of Data: 
This data set contains information from 2010-2021 regarding fatal vehicular accidents that have occured on highways within the United States by state/territory.
The data can be acessed at the following link: https://www.bts.gov/browse-statistical-products-and-data/state-transportation-statistics/transportation-safety
The varibles included in this dataset are as follows: 
- State: the state that the information comes from
- Fatality Type: A factor of 14 different types of fatalities (such as highway fatalities, SUV fatalities, etc.)
  - Highway Fatalities
  - Passenger Car Fatalities
  - SUV Fatalities
  - Pickup Truck Fatalities
  - Van Fatalities
  - Other Light Truck Fatalities
  - Motorcycle Fatalities
  - Bus Fatalities
  - Large Truck Fatalities
  - Pedalcyclist Fatalities
  - Pedestrian Fatalities
  - Other Nonoccupant Fatalities
  - Other Vehicle Fatalities
  - Unknown Person Type Fatalities
- Year: The year, from 2010 to 2021, of the number of a specific type of fatality in a state occured.
- TotalFatalities: the sum of all fatalities for each FatalityType and by year for overall and by each state.

#### Supplementary Datasets Used:
State Population Totals: 2010-2020
Our dataset from Bureau of Transportation Safety contains information 
from 2010-2021 regarding fatal vehicular accidents that have occurred 
on highways within the United States by state/territory.
The data can be accessed at the following link: https://www.census.gov/programs-surveys/popest/technical-documentation/research/evaluation-estimates/2020-evaluation-estimates/2010s-state-total.html
Usage: This dataset will be used for reporting the number of fatalities by state by capita.
The varibles included in this dataset are as follows: 
- Name: The state that information comes from.
- POPESTIMATE([2010-2021]): The population estimates for year ([2010-2021]).

#### Investigations: 
- What is the leading cause of highway fatalities overall/by state?
- What states, if any, have stark contrasts in vehicular fatalities? 
- Do these states have any laws or regulations that would cause this?
- Do any types of vehicular fatalities correlate with another?
- Have counts of certain types of vehicular fatalities increased or decreased over time?
- How did the COVID-19 pandemic during 2021 affect traffic fatalities?

#### Main:
The data does not account directly for population density. 
The data is raw numbers, and in order to get a better insight into what the
data means we have to look at it by state.



### Data Setup

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#### Highway Fatalities dataset being used

```{r, echo=FALSE, warning=FALSE}
# Datasets being used
hw <- read.csv("hw_fatal.csv")
head(hw)
```

#### Summary of the Highway Fatalities dataset

``` {r, echo=FALSE, warning=FALSE}
# information about data set
summary(hw)
```

#### State Populations dataset form 2010-2021 being used

``` {r, echo=FALSE, warning=FALSE}
statePop <- read.csv("state_populations_2010-2021.csv", col.names = c("State", "Y2010","Y2011","Y2012","Y2013","Y2014","Y2015","Y2016","Y2017","Y2018","Y2019","Y2020","Y2021"))
head(statePop)
```

#### Summary of the State Populations dataset

``` {r, echo=FALSE, warning=FALSE}
# information about dataset
summary(statePop)
```

### Cleaning up data

```{r, echo=FALSE, warning=FALSE}
# Cleaning data

## Fixing empty column name for Fatality Type, and making year column names start with a character
hw <-  read.csv("hw_fatal.csv", col.names = c("State","FatalityType","Y2010","Y2011","Y2012","Y2013","Y2014","Y2015","Y2016","Y2017","Y2018","Y2019","Y2020","Y2021","TotalFatalities"))

## Creating a seocnd dataset where there the whole country collectively is not included (just states and territories individually)
states <- hw %>% filter(State != "United States")
states$State <- tolower(states$State) # making joining with the map easier later on
```

#### Creating a seocnd dataset where there the whole country collectively is not included (just states and territories individually)

``` {r, echo=FALSE, warning=FALSE}
head(states)

## Parse the fatality by year as a number, and not a character.
states <- states %>%
    mutate (
        Y2010 = parse_number(Y2010),
        Y2011 = parse_number(Y2011),
        Y2012 = parse_number(Y2012),
        Y2013 = parse_number(Y2013),
        Y2014 = parse_number(Y2014),
        Y2015 = parse_number(Y2015),
        Y2016 = parse_number(Y2016),
        Y2017 = parse_number(Y2017),
        Y2018 = parse_number(Y2018),
        Y2019 = parse_number(Y2019),
        Y2020 = parse_number(Y2020),
        Y2021 = parse_number(Y2021),
        TotalFatalities = parse_number(TotalFatalities)
    )
```

#### Summary of newly created states dataset

``` {r, echo=FALSE, warning=FALSE}
# information about data set
summary(states)
```

#### Plan of Data Exploration

Break down each fatality type and plot the data by state, observe similarities and differences between the states for each fatality type.

### Data Exploration

```{r, echo=FALSE, warning=FALSE}
# Aadhi

# Initializing stuff
state_map <- map_data("state")

colnames(state_map)[5] <- "State"   # making join easier

states_year <- states %>%        # Organizing by year and the count a numeric to plot
  pivot_longer(cols = Y2010:Y2021, 
               names_to = "year", 
               values_to = "count") %>% 
  mutate(`count` = as.numeric(`count`))

states_pops <- statePop %>%        # Organizing by year and the count a numeric to plot
  pivot_longer(cols = Y2010:Y2021, 
               names_to = "year", 
               values_to = "population") %>% 
  mutate(`population` = as.numeric(`population`))


states_pops$State <- tolower(states_pops$State)

temp_states_old <- left_join(state_map, states_year, by = "State") # making df to plot
temp_states <- left_join(temp_states_old, states_pops, by = c("State", "year"))
```

``` {r, echo=FALSE, warning=FALSE}

## Construct map of fatalality by state (Roba)

states$region <- tolower(states$State)
state_map2 <- map_data("state")
state_map2 <- states %>% left_join(state_map2, by="region")
head(state_map2)
```

#### Highway Fatalities by Year for each State

``` {r, echo=FALSE, warning=FALSE}
# Overall highway fatalities by year and state
temp_states %>%
  filter(FatalityType == "Highway Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Highway Fatalities by State per Capita")

state_map2 %>% filter(FatalityType == "Highway Fatalities") %>% 
    mutate(total_fatalities = TotalFatalities, .by = State) %>%   
    ggplot(aes(x = long, y = lat)) + 
    geom_polygon(aes(group=group, fill = total_fatalities)) +
    scale_fill_continuous(name = "Death Count (2010 - 2021)") +
    ggtitle("Highway Fatalities by State (2010-2021)")

states_year %>% 
  filter(FatalityType == "Highway Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col(space=1) + 
  ggtitle("Highway Fatalities by Year by State") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

```{r, echo=FALSE, warning=FALSE}
# Aadhi

# Pedestrian Fatalities by Year
states_year %>% 
  filter(FatalityType == "Pedestrian Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col() + 
  ggtitle("Pedestrian Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Pedestrian Fatalities by State
temp_states %>% 
  filter(FatalityType == "Pedestrian Fatalities") %>% 
   mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Pedestrian Fatalities by State")

# Pedestrian Fatalities by State per capita
temp_states %>% 
  filter(FatalityType == "Pedestrian Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Pedestrian Fatalities by State")



# Other Nonoccupant Fatalities by Year
states_year %>% 
  filter(FatalityType == "Other Nonoccupant Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col() + 
  ggtitle("Other Nonoccupant Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Other Nonoccupant Fatalities by State

temp_states %>% 
  filter(FatalityType == "Other Nonoccupant Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Other Nonoccupant Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Other Nonoccupant Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Other Nonoccupant Fatalities by State")

# Other Vehicle Fatalities by Year
states_year %>% 
  filter(FatalityType == "Other Vehicle Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col() + 
  ggtitle("Other Vehicle Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Other Vehicle Fatalities by State
temp_states %>% 
  filter(FatalityType == "Other Vehicle Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Other Vehicle Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Other Vehicle Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Other Vehicle Fatalities by State")
```



```{r, echo=FALSE, warning=FALSE}
# Conor

# Pickup Truck Fatalities by Year (Conor)

states_year %>% 
  filter(FatalityType == "Pickup Truck Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Pickup Truck Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
 
# Pickup Truck Fatalities by State (Conor)

temp_states %>% 
  filter(FatalityType == "Pickup Truck Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Pickup Truck Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Pickup Truck Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Pickup Truck Fatalities by State")

# Van Fatalities by Year (Conor)

states_year %>% 
  filter(FatalityType == "Van Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Van Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Van Fatalities by State (Conor)

temp_states %>% 
  filter(FatalityType == "Van Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Van Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Van Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Van Fatalities by State")

# Other Light Truck Fatalities by Year (Conor)

states_year %>% 
  filter(FatalityType == "Other Light Truck Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Other Light Truck Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Other Light Truck Fatalities by State (Conor)

temp_states %>% 
  filter(FatalityType == "Other Light Truck Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Other Light Truck Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Other Light Truck Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Other Light Truck Fatalities by State")

# Motorcycle Fatalities by Year (Conor)

states_year %>% 
  filter(FatalityType == "Motorcycle Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Motorcycle Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Motorcycle Fatalities by State (Conor)

temp_states %>% 
  filter(FatalityType == "Motorcycle Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Motorcycle Fatalities by State")

temp_states %>% 
  filter(FatalityType == "Motorcycle Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Motorcycle Fatalities by State")


```

```{r, echo=FALSE, warning=FALSE}
# Daniel

# Bus Fatalities by year per state
states_year %>% 
  filter(FatalityType == "Bus Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col(space=1) + 
  ggtitle("Bus Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

temp_states %>%
  filter(FatalityType == "Bus Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Bus Fatalities by State")

temp_states %>%
  filter(FatalityType == "Bus Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Bus Fatalities by State")


# Large Truck Fatalities by year per state
states_year %>% 
  filter(FatalityType == "Large Truck Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col(space=1) + 
  ggtitle("Large Truck Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

temp_states %>%
  filter(FatalityType == "Large Truck Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Large Truck Fatalities by State")

temp_states %>%
  filter(FatalityType == "Large Truck Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Large Truck Fatalities by State")

# Pedalcyclist Fatalities by year per state
states_year %>% 
  filter(FatalityType == "Pedalcyclist Fatalities") %>% 
  ggplot(aes(x = year, y = count, fill = State)) + 
  geom_col(space=1) + 
  ggtitle("Pedalcyclist Fatalities by Year") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

temp_states %>%
  filter(FatalityType == "Pedalcyclist Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Pedalcyclist Fatalities by State per Capita")

temp_states %>%
  filter(FatalityType == "Pedalcyclist Fatalities") %>% 
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities)) + 
  ggtitle("Pedalcyclist Fatalities by State")

```


```{r, echo=FALSE, warning=FALSE}
# Roba
  
temp_states %>%
  filter(FatalityType == "Passenger Car Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("Passenger Car Fatalities by State per Capita")

state_map2 %>% filter(FatalityType == "Passenger Car Fatalities") %>%
    mutate(total_fatalities = TotalFatalities, .by = State) %>%    
    ggplot(aes(x = long, y = lat)) + 
    geom_polygon(aes(group=group, fill = total_fatalities)) +
    scale_fill_continuous(name = "Death Count (2010 - 2021)") +
    ggtitle("Passenger Car Fatalities by State")

temp_states %>%
  filter(FatalityType == "SUV Fatalities") %>% 
  mutate(total_pop = sum(population), .by = State) %>%
  mutate(total_fatalities = TotalFatalities, .by = State) %>% 
  ggplot(aes(x = long, y = lat)) + 
  geom_polygon(aes(group = group, fill = total_fatalities / total_pop)) + 
  ggtitle("SUV Fatalities by State per Capita")

state_map2 %>% filter(FatalityType == "SUV Fatalities") %>% 
    mutate(total_fatalities = TotalFatalities, .by = State) %>%    
    ggplot(aes(x = long, y = lat)) + 
    geom_polygon(aes(group=group, fill = total_fatalities)) +
    scale_fill_continuous(name = "Death Count (2010 - 2021)") +
    ggtitle("SUV Fatalities by State")

## Construct map of fatalality by year

state_map_year <- states %>% 
  pivot_longer(cols = Y2010:Y2021, 
               names_to = "year", 
               values_to = "count") %>% 
  mutate(`count` = as.numeric(`count`))

state_map_year %>% 
  filter(FatalityType == "Highway Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Highway Fatalities by Year")

state_map_year %>% 
  filter(FatalityType == "Passenger Car Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("Passenger Car Fatalities by Year")

state_map_year %>% 
  filter(FatalityType == "SUV Fatalities") %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_col() + 
  ggtitle("SUV Fatalities by Year")

state_map2 %>% filter(FatalityType == "Other Nonoccupant Fatalities") %>% 
    mutate(total_fatalities = TotalFatalities, .by = State) %>%    
    ggplot(aes(x = long, y = lat)) + 
    geom_polygon(aes(group=group, fill = total_fatalities)) +
    scale_fill_continuous(name = "Death Count (2010 - 2021)") +
    ggtitle("Other Nonoccupant Fatalities by State")
```


### Results:

The first cases of COVID-19 reached the US in January 2020, and the Trump Administration
declared a nationwide emergency on the COVID-19 pandemic in March 2021.
(https://www.cdc.gov/museum/timeline/covid19.html).

However, according to the National Highway Traffic Safety Administration,
the number of fatal traffic crashes increased by 6.8%. This would seem strange,
considering that less people overall were driving on the road without the need to
commute to work.
(https://www.nhtsa.gov/press-releases/2020-traffic-crash-data-fatalities)

Megan McArdle, a columnist the Washington Post, indicated that this may be due to an
increase in young and risky male drivers taking advantage of empty COVID-era roads.
A study done by the AAA Foundation for Traffic Safety indicated that young males were
the only people who indicated that they were driving more during the COVID pandemic -
taking their risky driving with them.
(https://www.washingtonpost.com/opinions/2022/03/10/pandemic-risky-driving-maybe-here-to-stay/).

Light Truck fatalities seems to be an exception to these sudden spike of fatal accidents
during the COVID-19 pandemic, due to young male drivers being less likely to own light trucks.

In addition, according to Michael Wilbur, a PHD Student in Vanderbilt University, in a paper 
published in the Transportation Research Record: Journal of the Transportation Research Board,
bus fatalities is also an exception to the sudden spike of fatal accidents
due to a decrease in operation hours for buses during the COVID-19 pandemic, as well as
social distancing measures and precautions advised and enforced by state legislature.
(https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10107069/)

Christy Bieber, J.D., indicated that the top 5 most deadliest states to drive in are
Montana, South Carolina, New Mexico, Wyoming, and Texas based on data from the
National Highway Traffic Safety Administration (NHTSA). This seems to align with
our data for Pedestrian  Fatalities by State Population Density.
(https://www.forbes.com/advisor/legal/most-dangerous-states-for-drivers/) 

```{r, echo=FALSE, warning=FALSE}



```

According to Alina Comoreanu, a Senior researcher at WalletHub, the top 5 states that 
had the most strictest enforcement on speeding and reckless driving are (in order) 
Delaware, Colorado, Arizona, New Mexico, and California. This seems to correlate
with our data for Pedestrian Fatalities by State Population Density.
(https://wallethub.com/edu/strictest-and-most-lenient-states-on-speeding/14211)





